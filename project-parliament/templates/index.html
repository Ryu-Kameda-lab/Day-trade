<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Parliament</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link
        href="https://fonts.googleapis.com/css2?family=M+PLUS+1p:wght@400;500;700;800&family=JetBrains+Mono:wght@400;500&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.5/socket.io.min.js"></script>
</head>

<body>
    <div class="app-container">

        <!-- ===== 左サイドバー（AIアイコン＋稼働状況） ===== -->
        <aside class="sidebar">
            <div class="sidebar-logo" title="Project Parliament">
                <div class="logo-icon">🏛️</div>
            </div>

            <nav class="ai-nav">
                {% for ai_id, profile in ai_profiles.items() %}
                <div class="ai-slot" id="slot-{{ ai_id }}" data-ai-id="{{ ai_id }}"
                    title="{{ profile.name }} - {{ profile.role_label }}">
                    <div class="ai-avatar" style="--ai-color: {{ profile.avatar_color }}">
                        <span class="ai-icon">{{ profile.icon }}</span>
                        <span class="status-indicator offline" id="indicator-{{ ai_id }}"></span>
                    </div>
                    <span class="ai-label">{{ profile.name }}</span>
                </div>
                {% endfor %}
            </nav>

            <div class="sidebar-bottom">
                <div class="ai-slot" title="設定">
                    <div class="ai-avatar" style="--ai-color: #64748b">
                        <span class="ai-icon">⚙️</span>
                    </div>
                </div>
            </div>
        </aside>

        <!-- ===== メインエリア ===== -->
        <div class="main-area">

            <!-- 上部：日付 + ステータスバー -->
            <header class="top-bar">
                <div class="top-left">
                    <span class="header-date" id="headerDate"></span>
                </div>
                <div class="top-center">
                    <div class="status-chip" id="statusChip" data-status="waiting">
                        <span class="status-pulse" id="statusPulse"></span>
                        <span class="status-text" id="statusText">AI起動待ち</span>
                    </div>
                </div>
                <div class="top-right">
                    <span class="online-badge" id="onlineBadge">
                        <span class="online-dot"></span> 0 / {{ ai_profiles|length }}
                    </span>
                </div>
            </header>

            <!-- 中央：チャットエリア -->
            <div class="chat-area" id="chatArea">
                <!-- 日付区切り -->
                <div class="date-divider">
                    <span id="chatDateLabel"></span>
                </div>

                <!-- ウェルカムメッセージ -->
                <div class="system-bubble welcome">
                    <div class="system-inner">
                        <span class="sys-icon">🏛️</span>
                        <span class="sys-text">
                            <strong>Project Parliament</strong> —
                            全AIを起動し、MEXC市場データに基づく議論を開始してください
                        </span>
                    </div>
                </div>
            </div>

            <!-- 下部：コントロールバー -->
            <div class="control-bar">

                <!-- フェーズ1: AI起動 -->
                <div class="ctrl-phase" id="phaseActivate">
                    <button class="ctrl-btn primary" id="btnActivateAll">
                        <span class="cb-icon">⚡</span> 全AIを起動
                    </button>
                </div>

                <!-- フェーズ2: 議論開始 -->
                <div class="ctrl-phase" id="phaseStart" style="display:none">
                    <div class="ctrl-row">
                        <button class="ctrl-btn accent" id="btnStart">
                            <span class="cb-icon">🚀</span> 議論を開始（MEXC市場データを取得）
                        </button>
                    </div>
                </div>

                <!-- フェーズ3: 議論進行中 -->
                <div class="ctrl-phase" id="phaseRunning" style="display:none">
                    <div class="ctrl-row">
                        <div class="typing-box" id="typingBox">
                            <div class="typing-dots"><span></span><span></span><span></span></div>
                            <span class="typing-who" id="typingWho">AIが分析中...</span>
                        </div>
                        <button class="ctrl-btn danger" id="btnStop">
                            <span class="cb-icon">⏹</span> 強制終了
                        </button>
                    </div>
                </div>

                <!-- フェーズ4: 完了 -->
                <div class="ctrl-phase" id="phaseComplete" style="display:none">
                    <div class="ctrl-row">
                        <button class="ctrl-btn download" id="btnDownload">
                            <span class="cb-icon">📥</span> 稟議書をダウンロード
                        </button>
                        <button class="ctrl-btn ghost" id="btnNewSession">
                            <span class="cb-icon">🔄</span> 新しい議論
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ===== 右パネル：タブ切替（稟議書 / ポジション / レポート） ===== -->
        <aside class="right-panel" id="rightPanel">
            <!-- タブヘッダー -->
            <div class="rpanel-tabs">
                <button class="rpanel-tab active" data-tab="proposal" id="tabProposal">📋 稟議書</button>
                <button class="rpanel-tab" data-tab="position" id="tabPosition">📊 ポジション</button>
                <button class="rpanel-tab" data-tab="reports" id="tabReports">📑 レポート</button>
            </div>

            <!-- === タブ1: 稟議書 === -->
            <div class="rpanel-content active" id="contentProposal">
                <div class="rpanel-head">
                    <span class="rpanel-badge" id="rpanelBadge">待機中</span>
                </div>
                <div class="rpanel-body" id="rpanelBody">
                    <div class="rpanel-empty">
                        <div class="empty-icon">📋</div>
                        <p>AIが稟議書を提出すると<br>ここに表示されます</p>
                    </div>
                </div>
                <div class="vote-board" id="voteBoard">
                    <h4 class="vote-title">投票状況</h4>
                    {% for ai_id, profile in ai_profiles.items() %}
                    {% if profile.can_vote %}
                    <div class="vote-row" id="voteRow-{{ ai_id }}">
                        <span class="vr-avatar" style="background:{{ profile.avatar_color }}">{{ profile.icon }}</span>
                        <span class="vr-name">{{ profile.name }}</span>
                        <span class="vr-result" id="voteResult-{{ ai_id }}">—</span>
                    </div>
                    {% endif %}
                    {% endfor %}
                </div>
            </div>

            <!-- === タブ2: ポジション監視 === -->
            <div class="rpanel-content" id="contentPosition">
                <div class="position-empty" id="positionEmpty">
                    <div class="empty-icon">📊</div>
                    <p>オープンポジションなし</p>
                </div>
                <div class="position-card" id="positionCard" style="display:none">
                    <div class="pos-header">
                        <span class="pos-symbol" id="posSymbol">—</span>
                        <span class="pos-strategy" id="posStrategy">—</span>
                    </div>
                    <div class="pos-price-row">
                        <div class="pos-current">
                            <span class="pos-label">現在価格</span>
                            <span class="pos-value" id="posCurrentPrice">—</span>
                        </div>
                        <div class="pos-pnl" id="posPnlBox">
                            <span class="pos-label">含み損益</span>
                            <span class="pos-value" id="posPnl">—</span>
                            <span class="pos-percent" id="posPnlPercent">—</span>
                        </div>
                    </div>
                    <div class="pos-levels">
                        <div class="pos-level tp">
                            <span class="level-icon">🎯</span>
                            <span class="level-label">利確</span>
                            <span class="level-value" id="posTp">—</span>
                        </div>
                        <div class="pos-level entry">
                            <span class="level-icon">➡️</span>
                            <span class="level-label">エントリー</span>
                            <span class="level-value" id="posEntry">—</span>
                        </div>
                        <div class="pos-level sl">
                            <span class="level-icon">🛡️</span>
                            <span class="level-label">損切</span>
                            <span class="level-value" id="posSl">—</span>
                        </div>
                    </div>
                    <div class="pos-indicators" id="posIndicators">
                        <div class="pos-ind">
                            <span class="ind-label">RSI</span>
                            <span class="ind-value" id="posRsi">—</span>
                        </div>
                        <div class="pos-ind">
                            <span class="ind-label">出来高</span>
                            <span class="ind-value" id="posVolume">—</span>
                        </div>
                        <div class="pos-ind">
                            <span class="ind-label">時間</span>
                            <span class="ind-value" id="posTime">—</span>
                        </div>
                    </div>
                    <div class="pos-flags" id="posFlags">
                        <span class="pos-flag" id="flagTrailing" style="display:none">🔄 トレイリングストップ有効</span>
                        <span class="pos-flag" id="flagPartial" style="display:none">✂️ 部分利確済み</span>
                    </div>
                </div>
            </div>

            <!-- === タブ3: レポート === -->
            <div class="rpanel-content" id="contentReports">
                <div class="reports-empty" id="reportsEmpty">
                    <div class="empty-icon">📑</div>
                    <p>トレード完了後に<br>AI分析レポートが表示されます</p>
                </div>
                <div class="reports-list" id="reportsList"></div>
            </div>
        </aside>
    </div>

    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>

</html>